---
title: CommonNovel 仕様
author: Alice Project
version: '0.1.0'
date: '2025-07-29'
license: '[CC-BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/deed.ja)'
---

# 1. 導入

## 1.1. Anov 構文とは?

Anov (Advanced-Novel) はノベルゲームの開発のための単純なテキストフォーマットです。Alice Project の創始者である [Lemon73](https://github.com/Lemon73-Computing) によって開発され、2023年に [Alice Novel v0.9.0-alpha](https://github.com/AliceNovel/AliceNovel/tree/v0.9.0-alpha) でノベルゲームを動かせる形として配布されました。

## 1.2. 仕様の必要性

Alice Novel v0.9.0-alpha から v0.9.4 にかけて、具体的な仕様書はありませんでした。([Alice Docs](https://github.com/AliceNovel/AliceDocs/tree/d9661d5127fee02f33057ed77421afc23bb0634e/content/ja/docs/anov) を除いて)

これは、Anov において"構文エラー"が表示されないため、どこが間違えているのかの発見が難しく問題となっていました。

## 1.3. この資料について

この資料は Anov 構文の明確な構文を提供することを目的としています。これは、Anov と NovelIL で対応するたくさんの例を表示することを含みます。

例として、この`→`文字は、<kbd>Tab</kbd> として利用されます。

# 2. まえがき

## 2.1. 文字と行

追記予定

## 2.2. タブ

追記予定

## 2.3. 安全でない文字

追記予定

## 2.4. バックスラッシュによる削除

追記予定

# 3. 節と行

## 3.1. 節とは?

CommonNovel では、**節** (ノード) と呼ばれる区分を利用します。ノベルゲームにおける最小の読み取り単位であり、一度の読み取りはこの単位ごとに行われます。

節は、空白行 (空白または、スペース、タブ、改行コードのみの行) から次の空白行までの複数行を示します。

節は0行以上、(理論上は) 上限なしの区間を示しています。

以下に例を示します:

### 例1 (通常の例)

```sh
- アリス
[こんにちは!!]

- うさぎ
[はい、こんにちは。]

```

この例では、初めの節は `- アリス` と `[こんにちは!!]` の2行となります。続く節は、`- うさぎ` と `[はい、こんにちは。]` の2行が対象です。

### 例2 (空白行の連続)

```sh
- アリス
[こんにちは!!]


- うさぎ
[はい、こんにちは。]

```

この例は、[例1](#例1-通常の例)と類似していますが、`[こんにちは!!]` と `- うさぎ` の間が2行空いています。そのため、初めの節は先程と同様に `- アリス` と `[こんにちは!!]` の2行ですが、その次の節は、` ` (空白) となります。[^line-of-nothing]そして、最後の節が `- うさぎ` と `[はい、こんにちは。]` の2行となります。

[^line-of-nothing]: 公式仕様上はこの通りですが、いくつかのツールは空白の節を削除する機能を追加する予定です。

### 例3 (節内の重複)

```sh
- アリス
[おはようございます。]
[こんにちは。]

```

この例は、1つの節で同じコマンドを2回使う例です。この場合は、後者である `[こんにちは。]` を優先して読み込みます。

これは仕様上問題はありません。しかし、可能なら`[重複] 前者は利用されないため不要です。`と表示することを推奨します。

# 4. 基本コマンド

本章では Anov 資料を作り上げるいくつもの異なるコマンドを記載しています。プラグイン不要で利用できる"基本コマンド"について記載しており、プラグインによって利用できる"拡張コマンド"については記載しません。

## 4.1. 会話

(変換前: `main.anov`)
```sh
[テキスト]
```

(変換後: `main.nil`)
```json
{
  "cells": [
    {
      "messages": "テキスト" // または "text"
    }
  ]
}
```

## 4.2. キャラクター名

(変換前: `main.anov`)
```sh
- キャラクター名
```

(変換後: `main.nil`)
```json
{
  "cells": [
    {
      "character-name": "キャラクター名", // または "name"
      "images": {
        "foreground": "キャラクター名.png" // または "character"
      }
    }
  ]
}
```

後述する[感情](#43-キャラクター画像感情)が追加で利用できます。詳細はそちらを参照してください。

## 4.3. キャラクター画像/感情

(変換前: `main.anov`)
```sh
/ 感情
```

(変換後: `main.nil`)
```json
{
  "cells": [
    {
      "images": {
        "foreground": "(キャラクター名)-感情.png" // または "character"
      }
    }
  ]
}
```

基本的に、先述した[キャラクター](#42-キャラクター名)と同時に利用します。

(変換前: `main.anov`)
```sh
- キャラクター / 感情
```

(変換後: `main.nil`)
```json
{
  "cells": [
    {
      "character-name": "キャラクター名", // または "name"
      "images": {
        "foreground": "キャラクター名-感情.png" // または "character"
      }
    }
  ]
}
```

## 4.4. 背景画像/場所

(変換前: `main.anov`)
```sh
> 場所
```

(変換後: `main.nil`)
```json
{
  "cells": [
    {
      "images": {
        "background": "場所.png"
      }
    }
  ]
}
```

## 4.5. 音声再生

- `background`: 音声を再生しながら節を進めることができます。
- `foreground`: 音声が終わるまで節を進めることができません。

(変換前: `main.anov`)
```sh
audio: 音声
```

(変換後: `main.nil`)
```json
{
  "cells": [
    {
      "musics": { // または "audio"
        "background": "音声.mp3"
      }
    }
  ]
}
```

**音声の停止**

(変換前: `main.anov`)
```sh
audio: 
```

(変換後: `main.nil`)
```json
{
  "cells": [
    {
      "musics": { // または "audio"
        "background": ""
      }
    }
  ]
}
```

## 4.6. 動画再生

- `background`: 動画を再生しながら節を進めることができます。
- `foreground`: 動画が終わるまで節を進めることができません。

(変換前: `main.anov`)
```sh
movie: 動画
```

(変換後: `main.nil`)
```json
{
  "cells": [
    {
      "movies": {
        "foreground": "動画.mp4"
      }
    }
  ]
}
```

# 5. 議論中

*本章は現在議論中の機能について記載しています。*

## 5.1. 外部ファイルの拡張子指定

画像ファイルなど、外部ファイルの読み込みの際には拡張子を指定する必要があります。

現在、場所コマンド `> 場所` は、場所の指定と画像の表示を兼任していますが、拡張子を含む `> 場所.png` とするべきかという議論です。現状は拡張子を含む `場所.png` を優先しています。

<!--
昔のバージョンでは、拡張子を含んでいませんでしたが、かつては場所指定に関しても Json ファイルで行う計画だったからです。現在は、場所や人物の設定ファイルは作成しないことにほとんど決定しています。
-->

## 5.2. フラグ/条件分岐

シナリオ分岐などの分岐処理を行うためには、フラグや条件分岐の仕様を追加する必要があります。

## 5.3. 引数

アニメーションの種類や、秒数の指定など、引数が必要になる場面が存在します。現在は `:fading` や `{fading}` などの構文を構想しています。

## 5.4. プラグイン

(高度) 基本コマンド以外の処理ができるように、プラグインシステムの導入を検討する必要があります。プラグインはセキュリティー問題を考慮して実装する必要があります。

## 5.5. 別ファイルへのリンク

1つのファイルが肥大化しないように、別のファイルを開く機能を追加する必要があります。

例:
```sh
# main.anov
<next.anov>

```

これは、`main.anov` ファイルから、`next.anov` ファイルに移動する例を示しています。

## 5.6. Anproj 形式

Anov ファイルでは、設定ファイルや画像ファイルを統合するため、Anproj (ZIP) 形式のファイルが利用されてきました。現状、CommonNovel にはこれに類する、または代替できるシステムが提供されておらず、実環境での利用を想定すると、機能が不足していると考えられます。

# 備考

## ライセンス

[CC-BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/deed.ja)

Copyright © 2023-2025, Alice Project.

## 参考

- [commonmark-spec 0.29](https://commonmark-ja.readthedocs.io/ja/latest/spec.html)
